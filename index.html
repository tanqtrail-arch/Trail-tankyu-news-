<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TRAILæ¢ç©¶ãƒ‹ãƒ¥ãƒ¼ã‚¹ï½œæ¢ç©¶æ•™å®¤TRAIL</title>
  <meta name="description" content="æ¢ç©¶æ•™å®¤TRAILãŒç™ºä¿¡ã™ã‚‹ä¸­å­¦å—é¨“ãƒ»æ¢ç©¶æ•™è‚²ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€‚2026å¹´å…¥è©¦é€Ÿå ±ã€æ³¨ç›®æ ¡ã‚¬ã‚¤ãƒ‰ã€ä¿è­·è€…ã®å£°ã€‚" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”</text></svg>" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect, useRef } = React;

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ“ è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ â€” ã“ã“ã‚’ç·¨é›†ã™ã‚Œã°è¨˜äº‹ã®è¿½åŠ ãƒ»ä¿®æ­£ãŒã§ãã¾ã™
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
//
// ã€è¨˜äº‹ã®è¿½åŠ æ–¹æ³•ã€‘
// ARTICLESé…åˆ—ã«æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
// id: ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªæ•°å­—ï¼ˆé‡è¤‡ä¸å¯ï¼‰
// date: "2026å¹´2æœˆ6æ—¥" ã®ã‚ˆã†ãªå½¢å¼
// dateKey: "0206" ã®ã‚ˆã†ãªå½¢å¼ï¼ˆæ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ï¼‰
// category: "juken" | "school" | "tankyu" | "ai" | "oyako"
// title: è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«
// summary: ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹è¦ç´„ï¼ˆ1-2æ–‡ï¼‰
// heroEmoji: ã‚«ãƒ¼ãƒ‰ã«å¤§ããè¡¨ç¤ºã•ã‚Œã‚‹çµµæ–‡å­—
// accentColor: ã‚«ãƒ†ã‚´ãƒªè‰²ï¼ˆä¸‹ã®CATEGORY_COLORSã‚’å‚ç…§ï¼‰
// body: æœ¬æ–‡ãƒ–ãƒ­ãƒƒã‚¯ã®é…åˆ—ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰
// tags: ã‚¿ã‚°ã®é…åˆ—
// tankyuPoint: ğŸ§­æ¢ç©¶ãƒã‚¤ãƒ³ãƒˆï¼ˆçœç•¥å¯ï¼‰
// aiAngle: ğŸ¤–AIæ™‚ä»£ã®è¦–ç‚¹ï¼ˆçœç•¥å¯ï¼‰
// oyakoTalk: ğŸ’¬è¦ªå­ã§è©±ãã†ï¼ˆçœç•¥å¯ï¼‰
// videoUrl: YouTubeå‹•ç”»URLï¼ˆçœç•¥å¯ãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¿½åŠ å¯èƒ½ï¼‰
//
// ã€æœ¬æ–‡ãƒ–ãƒ­ãƒƒã‚¯ã®ç¨®é¡ã€‘
// { type: "text", content: "æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ" }
// { type: "heading", content: "å°è¦‹å‡ºã—" }
// { type: "list", items: ["é …ç›®1", "é …ç›®2"] }
// { type: "table", title: "è¡¨ã‚¿ã‚¤ãƒˆãƒ«", headers: [...], rows: [[...], ...] }
// { type: "highlight", items: [{ school: "å­¦æ ¡å", detail: "èª¬æ˜" }] }
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const SITE = {
  name: "ãƒˆãƒ¬ã‚¤ãƒ«æ¢ç©¶ãƒ‹ãƒ¥ãƒ¼ã‚¹",
  tagline: "ä¸­å­¦å—é¨“ Ã— æ¢ç©¶å­¦ç¿’ Ã— AIæ™‚ä»£ã®å­¦ã³",
  description: "æ¢ç©¶æ•™å®¤TRAILãŒå±Šã‘ã‚‹ã€è¦ªå­ã§èª­ã‚€ä¸­å­¦å—é¨“ãƒ‹ãƒ¥ãƒ¼ã‚¹",
};

const NAV_CATEGORIES = [
  { id: "all", label: "ã™ã¹ã¦", icon: "ğŸ“°" },
  { id: "juken", label: "å…¥è©¦é€Ÿå ±", icon: "ğŸ¯" },
  { id: "school", label: "å­¦æ ¡æƒ…å ±", icon: "ğŸ«" },
  { id: "tankyu", label: "æ¢ç©¶ã‚³ãƒ©ãƒ ", icon: "ğŸ”" },
  { id: "ai", label: "AIÃ—æ•™è‚²", icon: "ğŸ¤–" },
  { id: "oyako", label: "è¦ªå­ã§è€ƒãˆã‚‹", icon: "ğŸ’¬" },
];

const CATEGORY_COLORS = {
  juken: "#E8453C",
  school: "#059669",
  tankyu: "#D97706",
  ai: "#2563EB",
  oyako: "#7C3AED",
};

const CATEGORY_LABELS = {
  juken: "å…¥è©¦é€Ÿå ±",
  school: "å­¦æ ¡æƒ…å ±",
  tankyu: "æ¢ç©¶ã‚³ãƒ©ãƒ ",
  ai: "AIÃ—æ•™è‚²",
  oyako: "è¦ªå­ã§è€ƒãˆã‚‹",
};

const DATE_TABS = [
  { key: "all", label: "ã™ã¹ã¦" },
  { key: "0201", label: "2/1" },
  { key: "0202", label: "2/2" },
  { key: "0203", label: "2/3" },
  { key: "0204", label: "2/4" },
  { key: "0205", label: "2/5" },
  { key: "0206", label: "2/6" },
  { key: "0207", label: "2/7" },
  { key: "0208", label: "2/8" },
];

// â”â”â” å…¨25è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”



// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ¨ UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

function CalendarDropdown({ currentDate, onDateChange, onClose, articles }) {
  const calRef = useRef(null);

  useEffect(() => {
    const handleClick = (e) => {
      if (calRef.current && !calRef.current.contains(e.target)) onClose();
    };
    document.addEventListener("mousedown", handleClick);
    return () => document.removeEventListener("mousedown", handleClick);
  }, [onClose]);

  // February 2026 starts on Sunday (day 0)
  const daysInMonth = 28;
  const startDay = 0; // Sunday
  const dayNames = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
  const articleDates = articles
    ? [...new Set(articles.map(a => parseInt(a.dateKey.slice(2), 10)))]
    : [];

  const cells = [];
  for (let i = 0; i < startDay; i++) cells.push(null);
  for (let d = 1; d <= daysInMonth; d++) cells.push(d);

  const dateKeyFor = (d) => `02${String(d).padStart(2, "0")}`;
  const isSelected = (d) => currentDate === dateKeyFor(d);
  const hasArticle = (d) => articleDates.includes(d);

  return (
    <div ref={calRef} style={{
      position: "absolute", top: "100%", left: 0, marginTop: 6,
      background: "#fff", borderRadius: 16,
      border: "1px solid #E8E0D4",
      boxShadow: "0 12px 40px rgba(26,18,7,0.15)",
      padding: "20px", width: 300, zIndex: 200,
      animation: "calendarSlideIn 0.25s ease",
    }}>
      {/* Month header */}
      <div style={{
        display: "flex", alignItems: "center", justifyContent: "space-between",
        marginBottom: 16,
      }}>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 16, fontWeight: 800, color: "#1A1207",
        }}>ğŸ“… 2026å¹´2æœˆ</div>
        <button onClick={() => { onDateChange("all"); onClose(); }} style={{
          padding: "4px 12px", borderRadius: 12, border: "1px solid #D4C5AE",
          background: currentDate === "all" ? "#1A1207" : "#FFFCF7",
          color: currentDate === "all" ? "#fff" : "#6B5D4A",
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 11, fontWeight: 600, cursor: "pointer",
        }}>ã™ã¹ã¦è¡¨ç¤º</button>
      </div>

      {/* Day names */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(7, 1fr)", gap: 2, marginBottom: 4 }}>
        {dayNames.map((d, i) => (
          <div key={d} style={{
            textAlign: "center", padding: "4px 0",
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 10, fontWeight: 700,
            color: i === 0 ? "#E8453C" : i === 6 ? "#2563EB" : "#A0947E",
          }}>{d}</div>
        ))}
      </div>

      {/* Calendar grid */}
      <div style={{ display: "grid", gridTemplateColumns: "repeat(7, 1fr)", gap: 2 }}>
        {cells.map((day, i) => {
          if (day === null) return <div key={`e${i}`} />;
          const hasArt = hasArticle(day);
          const selected = isSelected(day);
          const isSunday = i % 7 === 0;
          const isSaturday = i % 7 === 6;

          return (
            <button
              key={day}
              onClick={() => {
                if (hasArt) { onDateChange(dateKeyFor(day)); onClose(); }
              }}
              style={{
                position: "relative",
                width: "100%", aspectRatio: "1", borderRadius: 12,
                border: selected ? "2px solid #EA580C" : "2px solid transparent",
                background: selected ? "#FFF7ED" : hasArt ? "#FFFCF7" : "transparent",
                cursor: hasArt ? "pointer" : "default",
                display: "flex", flexDirection: "column",
                alignItems: "center", justifyContent: "center", gap: 2,
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 14, fontWeight: hasArt ? 800 : 400,
                color: selected ? "#EA580C" : hasArt ? "#1A1207" : isSunday ? "#E8453C99" : isSaturday ? "#2563EB99" : "#C5B9A5",
                transition: "all 0.15s ease",
              }}
            >
              {day}
              {hasArt && (
                <div style={{
                  display: "flex", gap: 2, alignItems: "center",
                }}>
                  <span style={{
                    width: 5, height: 5, borderRadius: "50%",
                    background: selected ? "#EA580C" : "#F97316",
                  }} />
                </div>
              )}
            </button>
          );
        })}
      </div>

      {/* Legend */}
      <div style={{
        display: "flex", alignItems: "center", gap: 12,
        marginTop: 14, paddingTop: 12, borderTop: "1px solid #F0EBE2",
      }}>
        <div style={{ display: "flex", alignItems: "center", gap: 5 }}>
          <span style={{ width: 6, height: 6, borderRadius: "50%", background: "#F97316" }} />
          <span style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 10, color: "#8B7355",
          }}>è¨˜äº‹ã‚ã‚Š</span>
        </div>
        <span style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 10, color: "#A0947E",
        }}>æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã—ã¦çµã‚Šè¾¼ã¿</span>
      </div>
    </div>
  );
}

function Header({ onNav, currentCategory, currentDate, onDateChange, articles }) {
  const [scrolled, setScrolled] = useState(false);
  const [calendarOpen, setCalendarOpen] = useState(false);

  useEffect(() => {
    const h = () => setScrolled(window.scrollY > 40);
    window.addEventListener("scroll", h);
    return () => window.removeEventListener("scroll", h);
  }, []);

  const dateLabel = currentDate === "all"
    ? "2æœˆã®ãƒ‹ãƒ¥ãƒ¼ã‚¹"
    : `2æœˆ${parseInt(currentDate.slice(2))}æ—¥`;

  return (
    <header style={{
      position: "sticky", top: 0, zIndex: 100,
      background: scrolled ? "rgba(255,252,247,0.95)" : "#FFFCF7",
      backdropFilter: scrolled ? "blur(12px)" : "none",
      borderBottom: scrolled ? "1px solid #E8E0D4" : "1px solid transparent",
      transition: "all 0.3s ease",
    }}>
      <div style={{ maxWidth: 960, margin: "0 auto", padding: "0 20px" }}>
        <div style={{
          display: "flex", alignItems: "center", justifyContent: "space-between",
          padding: scrolled ? "10px 0" : "20px 0",
          transition: "padding 0.3s ease",
        }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, cursor: "pointer" }}
            onClick={() => { onNav("all"); onDateChange("all"); setCalendarOpen(false); }}>
            <div style={{
              width: 44, height: 44, borderRadius: 12,
              background: "linear-gradient(135deg, #F97316 0%, #EA580C 100%)",
              display: "flex", alignItems: "center", justifyContent: "center",
              fontSize: 22, boxShadow: "0 2px 8px rgba(249,115,22,0.3)",
            }}>ğŸ”</div>
            <div>
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif",
                fontWeight: 900, fontSize: scrolled ? 16 : 20,
                color: "#1A1207", letterSpacing: "-0.02em",
                transition: "font-size 0.3s ease",
              }}>ãƒˆãƒ¬ã‚¤ãƒ«æ¢ç©¶ãƒ‹ãƒ¥ãƒ¼ã‚¹</div>
              {!scrolled && (
                <div style={{
                  fontFamily: "'Zen Kaku Gothic New', sans-serif",
                  fontSize: 11, color: "#8B7355", letterSpacing: "0.05em", marginTop: 2,
                }}>ä¸­å­¦å—é¨“ Ã— æ¢ç©¶å­¦ç¿’ Ã— AIæ™‚ä»£ã®å­¦ã³</div>
              )}
            </div>
          </div>
          <a href="#about" style={{
            fontSize: 12, color: "#8B7355", textDecoration: "none",
            padding: "6px 14px", borderRadius: 20,
            border: "1px solid #D4C5AE", fontWeight: 600,
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
          }}>TRAILã«ã¤ã„ã¦</a>
        </div>

        {/* Date picker + Category nav row */}
        <div style={{
          display: "flex", alignItems: "center", gap: 8,
          padding: "8px 0 12px",
        }}>
          {/* Calendar button */}
          <div style={{ position: "relative" }}>
            <button
              onClick={() => setCalendarOpen(!calendarOpen)}
              style={{
                display: "flex", alignItems: "center", gap: 6,
                padding: "6px 14px", borderRadius: 20,
                border: currentDate !== "all" ? "2px solid #EA580C" : "1px solid #D4C5AE",
                background: currentDate !== "all" ? "#FFF7ED" : "#FFFCF7",
                cursor: "pointer",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 12, fontWeight: 700,
                color: currentDate !== "all" ? "#EA580C" : "#6B5D4A",
                transition: "all 0.2s ease",
              }}
            >
              <span style={{ fontSize: 14 }}>ğŸ“…</span>
              {dateLabel}
              <span style={{
                fontSize: 10, marginLeft: 2,
                transform: calendarOpen ? "rotate(180deg)" : "rotate(0deg)",
                transition: "transform 0.2s ease",
              }}>â–¼</span>
            </button>

            {calendarOpen && (
              <CalendarDropdown
                currentDate={currentDate}
                onDateChange={onDateChange}
                onClose={() => setCalendarOpen(false)}
                articles={articles}
              />
            )}
          </div>

          {/* Divider */}
          <div style={{ width: 1, height: 20, background: "#E8E0D4", flexShrink: 0 }} />

          {/* Category nav */}
          <nav style={{
            display: "flex", gap: 4, flex: 1,
            overflowX: "auto", scrollbarWidth: "none",
          }}>
            {NAV_CATEGORIES.map(cat => (
              <button key={cat.id} onClick={() => onNav(cat.id)} style={{
                display: "flex", alignItems: "center", gap: 5,
                padding: "6px 12px", borderRadius: 20,
                border: "none", cursor: "pointer",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 12, fontWeight: currentCategory === cat.id ? 700 : 500,
                background: currentCategory === cat.id ? "#1A1207" : "transparent",
                color: currentCategory === cat.id ? "#FFFCF7" : "#6B5D4A",
                whiteSpace: "nowrap", transition: "all 0.2s ease",
              }}>
                <span style={{ fontSize: 13 }}>{cat.icon}</span>
                {cat.label}
              </button>
            ))}
          </nav>
        </div>
      </div>
    </header>
  );
}

function HeroSection() {
  return (
    <section style={{
      background: "linear-gradient(135deg, #FFF7ED 0%, #FEF3E2 50%, #FFFBF5 100%)",
      borderBottom: "1px solid #E8E0D4",
      padding: "44px 20px 36px",
    }}>
      <div style={{ maxWidth: 960, margin: "0 auto" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 14 }}>
          <span style={{
            display: "inline-block", width: 8, height: 8, borderRadius: "50%",
            background: "#E8453C", animation: "pulse 2s infinite",
          }} />
          <span style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, fontWeight: 700, color: "#E8453C",
            letterSpacing: "0.08em",
          }}>LIVE â€” 2026å¹´2æœˆ</span>
        </div>
        <h1 style={{
          fontFamily: "'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif",
          fontSize: "clamp(22px, 5vw, 34px)", fontWeight: 900,
          color: "#1A1207", lineHeight: 1.35,
          letterSpacing: "-0.02em", margin: "0 0 10px",
        }}>
          2026å¹´ä¸­å­¦å…¥è©¦ã€ã¾ã•ã«çœŸã£æœ€ä¸­ã€‚<br/>
          <span style={{ color: "#EA580C" }}>æ¢ç©¶ã®ç›®ã§</span>ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª­ã‚‚ã†ã€‚
        </h1>
        <p style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 14, color: "#6B5D4A", lineHeight: 1.7,
          maxWidth: 560, margin: 0,
        }}>
          åå·®å€¤ã‚„åˆæ ¼ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã ã‘ã˜ã‚ƒãªã„ã€‚ã€Œãªãœï¼Ÿã€ã€Œæœ¬å½“ã«ï¼Ÿã€ã€Œè‡ªåˆ†ãªã‚‰ã©ã†è€ƒãˆã‚‹ï¼Ÿã€â€”â€”<br/>
          è¦ªå­ã§ä¸€ç·’ã«ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‹ã‚‰å­¦ã¶åŠ›ã‚’è‚²ã¦ã¾ã™ã€‚
        </p>
        <div style={{ display: "flex", gap: 10, marginTop: 20, flexWrap: "wrap" }}>
          {["ğŸ§’ å­ã©ã‚‚ã«ã‚‚èª­ã‚ã‚‹", "ğŸ¤– AIæ™‚ä»£ã®è¦–ç‚¹ã¤ã", "ğŸ’¬ è¦ªå­ã®å¯¾è©±ãƒã‚¿"].map(tag => (
            <span key={tag} style={{
              display: "inline-flex", alignItems: "center",
              padding: "5px 12px", borderRadius: 20,
              background: "rgba(234,88,12,0.08)",
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, fontWeight: 600, color: "#C2410C",
            }}>{tag}</span>
          ))}
        </div>
      </div>
    </section>
  );
}

function ArticleCard({ article, onSelect, index }) {
  const [hovered, setHovered] = useState(false);
  const color = CATEGORY_COLORS[article.category] || "#6B5D4A";
  const label = CATEGORY_LABELS[article.category] || "";

  return (
    <article
      onClick={() => onSelect(article)}
      onMouseEnter={() => setHovered(true)}
      onMouseLeave={() => setHovered(false)}
      style={{
        background: "#fff", borderRadius: 16,
        border: "1px solid #E8E0D4", overflow: "hidden",
        cursor: "pointer", transition: "all 0.3s ease",
        transform: hovered ? "translateY(-3px)" : "translateY(0)",
        boxShadow: hovered ? "0 10px 28px rgba(26,18,7,0.1)" : "0 2px 8px rgba(26,18,7,0.04)",
        animation: `fadeSlideUp 0.4s ease ${index * 0.06}s both`,
      }}
    >
      <div style={{ height: 4, background: `linear-gradient(90deg, ${color}, ${color}88)` }} />
      <div style={{ padding: "20px 22px 18px" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 10 }}>
          <span style={{
            padding: "2px 10px", borderRadius: 12,
            background: `${color}12`, color,
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 11, fontWeight: 700,
          }}>{label}</span>
          <span style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 11, color: "#A0947E",
          }}>{article.date}</span>
        </div>
        <div style={{ display: "flex", gap: 12, alignItems: "flex-start" }}>
          <span style={{ fontSize: 28, lineHeight: 1, flexShrink: 0, marginTop: 2 }}>{article.heroEmoji}</span>
          <div>
            <h2 style={{
              fontFamily: "'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif",
              fontSize: 16, fontWeight: 800, color: "#1A1207",
              lineHeight: 1.45, margin: "0 0 8px", letterSpacing: "-0.01em",
            }}>{article.title}</h2>
            <p style={{
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 13, color: "#6B5D4A", lineHeight: 1.6, margin: 0,
            }}>{article.summary}</p>
          </div>
        </div>
        <div style={{ display: "flex", gap: 6, marginTop: 14, flexWrap: "wrap", alignItems: "center" }}>
          {article.tags.slice(0, 3).map(tag => (
            <span key={tag} style={{
              padding: "2px 9px", borderRadius: 10, background: "#F5F0E8",
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 10, color: "#8B7355",
            }}>#{tag}</span>
          ))}
          <span style={{
            marginLeft: "auto",
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 11, color: "#EA580C", fontWeight: 600,
          }}>ç¶šãã‚’èª­ã‚€ â†’</span>
        </div>
      </div>
    </article>
  );
}

function SpecialBox({ type, title, icon, content }) {
  const styles = {
    tankyu: { bg: "#FFF7ED", border: "#F9731622", accent: "#EA580C" },
    ai: { bg: "#EFF6FF", border: "#3B82F622", accent: "#2563EB" },
    oyako: { bg: "#F0FDF4", border: "#22C55E22", accent: "#059669" },
  };
  const s = styles[type] || styles.tankyu;
  return (
    <div style={{
      background: s.bg, borderRadius: 14,
      border: `1px solid ${s.border}`, padding: "18px 20px", margin: "20px 0",
    }}>
      <div style={{
        fontFamily: "'Zen Kaku Gothic New', sans-serif",
        fontSize: 13, fontWeight: 800, color: s.accent, marginBottom: 8,
      }}>{icon} {title}</div>
      <div style={{
        fontFamily: "'Zen Kaku Gothic New', sans-serif",
        fontSize: 13, lineHeight: 1.8, color: "#2D2416",
      }}>{content}</div>
    </div>
  );
}

// YouTube URL â†’ embed ID å¤‰æ›
function extractYouTubeId(url) {
  if (!url) return null;
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/|youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,
    /^([a-zA-Z0-9_-]{11})$/,
  ];
  for (const p of patterns) {
    const m = url.match(p);
    if (m) return m[1];
  }
  return null;
}

function VideoEmbed({ url }) {
  const videoId = extractYouTubeId(url);
  if (!videoId) return null;
  return (
    <div style={{
      margin: "24px 0", borderRadius: 14, overflow: "hidden",
      border: "1px solid #E8E0D4",
      boxShadow: "0 2px 12px rgba(26,18,7,0.06)",
    }}>
      <div style={{
        fontFamily: "'Zen Kaku Gothic New', sans-serif",
        fontSize: 12, fontWeight: 700, color: "#6B5D4A",
        padding: "12px 16px 0", display: "flex", alignItems: "center", gap: 6,
      }}>
        <span style={{ fontSize: 14 }}>ğŸ¬</span> é–¢é€£å‹•ç”»
      </div>
      <div style={{
        position: "relative", paddingBottom: "56.25%", height: 0,
        margin: "10px 12px 12px",  borderRadius: 10, overflow: "hidden",
      }}>
        <iframe
          src={`https://www.youtube.com/embed/${videoId}`}
          title="é–¢é€£å‹•ç”»"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowFullScreen
          style={{
            position: "absolute", top: 0, left: 0,
            width: "100%", height: "100%", border: "none",
          }}
        />
      </div>
    </div>
  );
}

const REACTIONS = [
  { emoji: "ğŸ‘", label: "ã„ã„ã­" },
  { emoji: "ğŸ¤”", label: "è€ƒãˆã•ã›ã‚‰ã‚Œã‚‹" },
  { emoji: "ğŸ’¡", label: "ãªã‚‹ã»ã©" },
  { emoji: "â¤ï¸", label: "ã™ã" },
  { emoji: "ğŸ”¥", label: "ç†±ã„" },
];

function CommentSection({ articleId }) {
  const [comments, setComments] = useState([]);
  const [reactions, setReactions] = useState({});
  const [myReactions, setMyReactions] = useState({});
  const [name, setName] = useState("");
  const [text, setText] = useState("");
  const [role, setRole] = useState("parent");
  const [loading, setLoading] = useState(true);
  const [submitting, setSubmitting] = useState(false);
  const storageKey = `comments:${articleId}`;
  const reactionKey = `reactions:${articleId}`;
  const myReactionKey = `my-reactions:${articleId}`;

  // Load from storage
  useEffect(() => {
    const load = async () => {
      setLoading(true);
      try {
        const [cRes, rRes, mrRes] = await Promise.all([
          window.storage.get(storageKey, true).catch(() => null),
          window.storage.get(reactionKey, true).catch(() => null),
          window.storage.get(myReactionKey).catch(() => null),
        ]);
        if (cRes?.value) setComments(JSON.parse(cRes.value));
        if (rRes?.value) setReactions(JSON.parse(rRes.value));
        if (mrRes?.value) setMyReactions(JSON.parse(mrRes.value));
      } catch (e) {
        console.error("Storage load error:", e);
      }
      setLoading(false);
    };
    load();
  }, [articleId]);

  const handleReaction = async (emoji) => {
    const already = myReactions[emoji];
    const newMy = { ...myReactions, [emoji]: !already };
    const newR = { ...reactions };
    newR[emoji] = (newR[emoji] || 0) + (already ? -1 : 1);
    if (newR[emoji] <= 0) delete newR[emoji];
    setMyReactions(newMy);
    setReactions(newR);
    try {
      await window.storage.set(reactionKey, JSON.stringify(newR), true);
      await window.storage.set(myReactionKey, JSON.stringify(newMy));
    } catch (e) { console.error(e); }
  };

  const handleSubmit = async () => {
    if (!text.trim() || !name.trim()) return;
    setSubmitting(true);
    const newComment = {
      id: Date.now().toString(),
      name: name.trim(),
      role,
      text: text.trim(),
      time: new Date().toLocaleString("ja-JP"),
    };
    const updated = [newComment, ...comments];
    setComments(updated);
    setText("");
    try {
      await window.storage.set(storageKey, JSON.stringify(updated), true);
    } catch (e) { console.error(e); }
    setSubmitting(false);
  };

  const roleLabels = { parent: "ä¿è­·è€…", child: "å­ã©ã‚‚", teacher: "å…ˆç”Ÿ", other: "ãã®ä»–" };
  const roleColors = { parent: "#059669", child: "#EA580C", teacher: "#2563EB", other: "#8B7355" };

  return (
    <div style={{
      background: "#fff", borderRadius: 20,
      border: "1px solid #E8E0D4", overflow: "hidden",
      boxShadow: "0 4px 16px rgba(26,18,7,0.04)",
      marginTop: 20,
    }}>
      <div style={{ padding: "24px 24px 28px" }}>
        {/* Reactions */}
        <div style={{ marginBottom: 24 }}>
          <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 13, fontWeight: 800, color: "#1A1207", marginBottom: 12,
          }}>ã“ã®è¨˜äº‹ã©ã†ã ã£ãŸï¼Ÿ</div>
          <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
            {REACTIONS.map(r => {
              const count = reactions[r.emoji] || 0;
              const active = myReactions[r.emoji];
              return (
                <button key={r.emoji} onClick={() => handleReaction(r.emoji)} style={{
                  display: "flex", alignItems: "center", gap: 6,
                  padding: "8px 14px", borderRadius: 24,
                  border: active ? "2px solid #F97316" : "1px solid #E8E0D4",
                  background: active ? "#FFF7ED" : "#FFFCF7",
                  cursor: "pointer", transition: "all 0.2s ease",
                  transform: active ? "scale(1.05)" : "scale(1)",
                }}>
                  <span style={{ fontSize: 18 }}>{r.emoji}</span>
                  <span style={{
                    fontFamily: "'Zen Kaku Gothic New', sans-serif",
                    fontSize: 11, fontWeight: 600,
                    color: active ? "#EA580C" : "#8B7355",
                  }}>{r.label}</span>
                  {count > 0 && (
                    <span style={{
                      fontFamily: "'Zen Kaku Gothic New', sans-serif",
                      fontSize: 11, fontWeight: 800,
                      color: active ? "#EA580C" : "#A0947E",
                      background: active ? "#FDBA7422" : "#F5F0E8",
                      padding: "1px 7px", borderRadius: 10,
                    }}>{count}</span>
                  )}
                </button>
              );
            })}
          </div>
        </div>

        {/* Divider */}
        <div style={{ height: 1, background: "#F0EBE2", margin: "0 0 24px" }} />

        {/* Comment form */}
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 13, fontWeight: 800, color: "#1A1207", marginBottom: 14,
        }}>ğŸ’¬ ã¿ã‚“ãªã®ã‚³ãƒ¡ãƒ³ãƒˆ</div>

        <div style={{
          background: "#F9F4EC", borderRadius: 14, padding: "18px 18px 14px",
          marginBottom: 20,
        }}>
          <div style={{ display: "flex", gap: 10, marginBottom: 12, flexWrap: "wrap" }}>
            <input type="text" placeholder="ãªã¾ãˆï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚OKï¼‰"
              value={name} onChange={e => setName(e.target.value)}
              style={{
                flex: "1 1 120px", padding: "8px 14px", borderRadius: 10,
                border: "1px solid #D4C5AE", background: "#fff",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 13, color: "#1A1207", outline: "none",
              }}
            />
            <div style={{ display: "flex", gap: 4 }}>
              {Object.entries(roleLabels).map(([k, v]) => (
                <button key={k} onClick={() => setRole(k)} style={{
                  padding: "6px 10px", borderRadius: 12, border: "none", cursor: "pointer",
                  fontFamily: "'Zen Kaku Gothic New', sans-serif",
                  fontSize: 10, fontWeight: role === k ? 700 : 500,
                  background: role === k ? roleColors[k] + "18" : "transparent",
                  color: role === k ? roleColors[k] : "#A0947E",
                  transition: "all 0.15s ease",
                }}>{v}</button>
              ))}
            </div>
          </div>
          <textarea
            placeholder="ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§æ€ã£ãŸã“ã¨ã€è¦ªå­ã§è©±ã—ãŸã“ã¨ã€è³ªå•ãªã©ã‚’æ›¸ã„ã¦ã¿ã‚ˆã† âœï¸"
            value={text} onChange={e => setText(e.target.value)}
            rows={3}
            style={{
              width: "100%", padding: "10px 14px", borderRadius: 10,
              border: "1px solid #D4C5AE", background: "#fff",
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 13, color: "#1A1207", lineHeight: 1.7,
              resize: "vertical", outline: "none",
            }}
          />
          <div style={{ display: "flex", justifyContent: "flex-end", marginTop: 10 }}>
            <button onClick={handleSubmit}
              disabled={!text.trim() || !name.trim() || submitting}
              style={{
                padding: "8px 20px", borderRadius: 20, border: "none",
                background: (!text.trim() || !name.trim()) ? "#D4C5AE" : "linear-gradient(135deg, #F97316, #EA580C)",
                color: "#fff", cursor: (!text.trim() || !name.trim()) ? "default" : "pointer",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 12, fontWeight: 700,
                boxShadow: (text.trim() && name.trim()) ? "0 2px 8px rgba(249,115,22,0.3)" : "none",
                transition: "all 0.2s ease",
                opacity: submitting ? 0.6 : 1,
              }}
            >{submitting ? "é€ä¿¡ä¸­â€¦" : "ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹"}</button>
          </div>
        </div>

        {/* Comment list */}
        {loading ? (
          <div style={{
            textAlign: "center", padding: "20px",
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, color: "#A0947E",
          }}>èª­ã¿è¾¼ã¿ä¸­â€¦</div>
        ) : comments.length === 0 ? (
          <div style={{
            textAlign: "center", padding: "28px 20px",
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            color: "#A0947E",
          }}>
            <div style={{ fontSize: 28, marginBottom: 8 }}>ğŸŒ±</div>
            <div style={{ fontSize: 12 }}>ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®ä¸€äººã«ãªã‚ã†ï¼</div>
          </div>
        ) : (
          <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
            {comments.map((c, i) => (
              <div key={c.id} style={{
                display: "flex", gap: 12, alignItems: "flex-start",
                animation: i === 0 ? "fadeSlideUp 0.3s ease" : "none",
              }}>
                <div style={{
                  width: 34, height: 34, borderRadius: "50%", flexShrink: 0,
                  background: `${roleColors[c.role] || "#8B7355"}18`,
                  display: "flex", alignItems: "center", justifyContent: "center",
                  fontFamily: "'Zen Kaku Gothic New', sans-serif",
                  fontSize: 13, fontWeight: 800,
                  color: roleColors[c.role] || "#8B7355",
                }}>{c.name.charAt(0)}</div>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 4 }}>
                    <span style={{
                      fontFamily: "'Zen Kaku Gothic New', sans-serif",
                      fontSize: 12, fontWeight: 700, color: "#1A1207",
                    }}>{c.name}</span>
                    <span style={{
                      padding: "1px 7px", borderRadius: 8,
                      background: `${roleColors[c.role] || "#8B7355"}12`,
                      fontFamily: "'Zen Kaku Gothic New', sans-serif",
                      fontSize: 9, fontWeight: 700,
                      color: roleColors[c.role] || "#8B7355",
                    }}>{roleLabels[c.role] || "ãã®ä»–"}</span>
                    <span style={{
                      fontFamily: "'Zen Kaku Gothic New', sans-serif",
                      fontSize: 10, color: "#C5B9A5",
                    }}>{c.time}</span>
                  </div>
                  <div style={{
                    fontFamily: "'Zen Kaku Gothic New', sans-serif",
                    fontSize: 13, lineHeight: 1.7, color: "#2D2416",
                    background: "#F9F4EC", borderRadius: 12,
                    padding: "10px 14px",
                  }}>{c.text}</div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

function ArticleDetail({ article, onBack, showComments = false }) {
  const topRef = useRef(null);
  const color = CATEGORY_COLORS[article.category] || "#6B5D4A";
  const label = CATEGORY_LABELS[article.category] || "";

  useEffect(() => {
    topRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [article]);

  const renderBlock = (block, i) => {
    if (block.type === "text") {
      return (
        <p key={i} style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 15, lineHeight: 1.85, color: "#2D2416", margin: "0 0 18px",
        }}>{block.content}</p>
      );
    }
    if (block.type === "heading") {
      return (
        <h3 key={i} style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 16, fontWeight: 800, color: "#1A1207",
          margin: "28px 0 12px", paddingLeft: 14,
          borderLeft: `4px solid ${color}`,
        }}>{block.content}</h3>
      );
    }
    if (block.type === "quote") {
      return (
        <blockquote key={i} style={{
          margin: "20px 0", padding: "16px 20px",
          background: "#F9F4EC", borderLeft: `4px solid ${color}`,
          borderRadius: "0 12px 12px 0",
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 14, lineHeight: 1.8, color: "#2D2416", fontStyle: "italic",
        }}>
          <div>{block.content}</div>
          {block.source && <div style={{ marginTop: 8, fontSize: 12, color: "#8B7355", fontStyle: "normal" }}>â€”â€” {block.source}</div>}
        </blockquote>
      );
    }
    if (block.type === "callout") {
      const bgMap = { info: "#EFF6FF", warning: "#FFFBEB", success: "#F0FDF4", pink: "#FFF1F2" };
      const borderMap = { info: "#3B82F6", warning: "#F59E0B", success: "#10B981", pink: "#F43F5E" };
      const bg = bgMap[block.style] || bgMap.info;
      const border = borderMap[block.style] || borderMap.info;
      return (
        <div key={i} style={{
          margin: "20px 0", padding: "16px 20px",
          background: bg, border: `1px solid ${border}33`,
          borderRadius: 12, borderLeft: `4px solid ${border}`,
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
        }}>
          {block.title && <div style={{ fontSize: 13, fontWeight: 800, color: border, marginBottom: 6 }}>{block.title}</div>}
          <div style={{ fontSize: 14, lineHeight: 1.75, color: "#2D2416" }}>{block.content}</div>
        </div>
      );
    }
    if (block.type === "stat") {
      return (
        <div key={i} style={{
          display: "flex", flexWrap: "wrap", gap: 12, margin: "20px 0",
        }}>
          {block.items.map((s, j) => (
            <div key={j} style={{
              flex: "1 1 140px", background: "#fff", border: "1px solid #E8E0D4",
              borderRadius: 14, padding: "18px 16px", textAlign: "center",
              boxShadow: "0 2px 8px rgba(26,18,7,0.04)",
            }}>
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 28, fontWeight: 900, color: color,
                letterSpacing: "-0.02em",
              }}>{s.value}</div>
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 11, fontWeight: 600, color: "#6B5D4A", marginTop: 4,
              }}>{s.label}</div>
            </div>
          ))}
        </div>
      );
    }
    if (block.type === "chart") {
      const maxVal = Math.max(...block.data.map(d => d.value));
      return (
        <div key={i} style={{ margin: "24px 0" }}>
          {block.title && <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 13, fontWeight: 700, color: "#6B5D4A", marginBottom: 12,
          }}>{block.title}</div>}
          <div style={{
            background: "#fff", border: "1px solid #E8E0D4", borderRadius: 14,
            padding: "20px 16px", boxShadow: "0 2px 8px rgba(26,18,7,0.04)",
          }}>
            {block.data.map((d, j) => (
              <div key={j} style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: j < block.data.length - 1 ? 10 : 0 }}>
                <div style={{
                  width: 80, textAlign: "right", fontSize: 11, fontWeight: 600,
                  fontFamily: "'Zen Kaku Gothic New', sans-serif", color: "#6B5D4A",
                  flexShrink: 0,
                }}>{d.label}</div>
                <div style={{ flex: 1, height: 24, background: "#F5F0E8", borderRadius: 6, overflow: "hidden" }}>
                  <div style={{
                    width: `${(d.value / maxVal) * 100}%`,
                    height: "100%", borderRadius: 6,
                    background: `linear-gradient(90deg, ${d.color || color}, ${d.color || color}AA)`,
                    transition: "width 0.6s ease",
                  }} />
                </div>
                <div style={{
                  width: 48, fontSize: 12, fontWeight: 700,
                  fontFamily: "'Zen Kaku Gothic New', sans-serif", color: "#2D2416",
                  flexShrink: 0,
                }}>{d.value}{block.unit || ""}</div>
              </div>
            ))}
          </div>
          {block.source && <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 10, color: "#A89B8C", marginTop: 6, textAlign: "right",
          }}>å‡ºå…¸: {block.source}</div>}
        </div>
      );
    }
    if (block.type === "table") {
      return (
        <div key={i} style={{ margin: "20px 0", overflowX: "auto" }}>
          <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, fontWeight: 700, color: "#6B5D4A", marginBottom: 8,
          }}>{block.title}</div>
          <table style={{
            width: "100%", borderCollapse: "collapse",
            fontFamily: "'Zen Kaku Gothic New', sans-serif", fontSize: 12,
          }}>
            <thead>
              <tr>{block.headers.map((h, j) => (
                <th key={j} style={{
                  padding: "9px 12px", textAlign: j === 0 ? "left" : "center",
                  background: "#1A1207", color: "#FFFCF7", fontWeight: 700, fontSize: 11,
                  borderRadius: j === 0 ? "8px 0 0 0" : j === block.headers.length - 1 ? "0 8px 0 0" : 0,
                }}>{h}</th>
              ))}</tr>
            </thead>
            <tbody>
              {block.rows.map((row, ri) => (
                <tr key={ri} style={{ background: ri % 2 === 0 ? "#FFFCF7" : "#F9F4EC" }}>
                  {row.map((cell, ci) => (
                    <td key={ci} style={{
                      padding: "8px 12px", textAlign: ci === 0 ? "left" : "center",
                      borderBottom: "1px solid #E8E0D4", fontWeight: ci === 0 ? 600 : 400,
                      color: ci === 2 ? (cell.startsWith("+") ? "#059669" : cell.startsWith("âˆ’") ? "#E8453C" : "#6B5D4A") : "#2D2416",
                    }}>{cell}</td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }
    if (block.type === "list") {
      return (
        <ul key={i} style={{ margin: "12px 0 18px", paddingLeft: 24 }}>
          {block.items.map((item, j) => (
            <li key={j} style={{
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 14, lineHeight: 1.8, color: "#2D2416", marginBottom: 6,
            }}>{item}</li>
          ))}
        </ul>
      );
    }
    return null;
  };

  return (
    <div ref={topRef} style={{ animation: "fadeIn 0.4s ease" }}>
      <button onClick={onBack} style={{
        display: "inline-flex", alignItems: "center", gap: 6,
        padding: "7px 14px", borderRadius: 20,
        border: "1px solid #D4C5AE", background: "#FFFCF7",
        cursor: "pointer", marginBottom: 20,
        fontFamily: "'Zen Kaku Gothic New', sans-serif",
        fontSize: 12, fontWeight: 600, color: "#6B5D4A",
      }}>â† è¨˜äº‹ä¸€è¦§ã«ã‚‚ã©ã‚‹</button>

      <div style={{
        background: "#fff", borderRadius: 20,
        border: "1px solid #E8E0D4", overflow: "hidden",
        boxShadow: "0 4px 16px rgba(26,18,7,0.06)",
      }}>
        <div style={{ height: 5, background: `linear-gradient(90deg, ${color}, ${color}66)` }} />
        <div style={{ padding: "28px 24px 32px" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 14 }}>
            <span style={{
              padding: "3px 12px", borderRadius: 12,
              background: `${color}12`, color,
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, fontWeight: 700,
            }}>{label}</span>
            <span style={{
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, color: "#A0947E",
            }}>{article.date}</span>
          </div>

          <div style={{ display: "flex", gap: 14, alignItems: "flex-start", marginBottom: 24 }}>
            <span style={{ fontSize: 38, lineHeight: 1, flexShrink: 0 }}>{article.heroEmoji}</span>
            <h1 style={{
              fontFamily: "'Zen Kaku Gothic New', 'Noto Sans JP', sans-serif",
              fontSize: "clamp(18px, 4vw, 26px)", fontWeight: 900,
              color: "#1A1207", lineHeight: 1.4, letterSpacing: "-0.02em", margin: 0,
            }}>{article.title}</h1>
          </div>

          <div style={{
            display: "flex", alignItems: "center", gap: 10,
            padding: "12px 16px", borderRadius: 12,
            background: "#F9F4EC", marginBottom: 28,
          }}>
            <div style={{
              width: 32, height: 32, borderRadius: "50%",
              background: "linear-gradient(135deg, #F97316, #EA580C)",
              display: "flex", alignItems: "center", justifyContent: "center",
              fontSize: 14, color: "#fff", fontWeight: 800,
            }}>T</div>
            <div>
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 12, fontWeight: 700, color: "#1A1207",
              }}>æ¢ç©¶æ•™å®¤TRAIL ç·¨é›†éƒ¨</div>
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 10, color: "#8B7355",
              }}>ã€Œè€ƒãˆã‚‹åŠ›ã€ã‚’è‚²ã¦ã‚‹è¦–ç‚¹ã§ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è§£èª¬</div>
            </div>
          </div>

          {/* Body */}
          {article.body.map((block, i) => renderBlock(block, i))}

          {/* Special sections */}
          {article.tankyuPoint && (
            <SpecialBox type="tankyu" title="TRAILæ¢ç©¶ãƒã‚¤ãƒ³ãƒˆ" icon="ğŸ§­" content={article.tankyuPoint} />
          )}
          {article.aiAngle && (
            <SpecialBox type="ai" title="AIæ™‚ä»£ã®è¦–ç‚¹" icon="ğŸ¤–" content={article.aiAngle} />
          )}
          {article.oyakoTalk && (
            <SpecialBox type="oyako" title="è¦ªå­ã§è©±ãã†" icon="ğŸ’¬" content={article.oyakoTalk} />
          )}

          {/* Related video */}
          {article.videoUrl && <VideoEmbed url={article.videoUrl} />}

          {/* Tags */}
          <div style={{
            display: "flex", gap: 7, flexWrap: "wrap",
            marginTop: 24, paddingTop: 18, borderTop: "1px solid #E8E0D4",
          }}>
            {article.tags.map(tag => (
              <span key={tag} style={{
                padding: "4px 11px", borderRadius: 12, background: "#F5F0E8",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 11, color: "#8B7355",
              }}>#{tag}</span>
            ))}
          </div>
        </div>
      </div>

      {/* Comments & Reactions */}
      {showComments && <CommentSection articleId={article.id} />}
    </div>
  );
}

function Sidebar() {
  return (
    <aside style={{ display: "flex", flexDirection: "column", gap: 18 }}>
      {/* Article count */}
      <div style={{
        background: "linear-gradient(135deg, #FFF7ED, #FEF3E2)",
        borderRadius: 14, padding: "18px 20px",
        border: "1px solid #F9731622",
        textAlign: "center",
      }}>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 36, fontWeight: 900, color: "#EA580C",
        }}>25</div>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 12, color: "#8B7355", fontWeight: 600,
        }}>è¨˜äº‹ã‚’å…¬é–‹ä¸­ï¼ˆ2/1ã€œ2/5ï¼‰</div>
      </div>

      {/* About TRAIL */}
      <div id="about" style={{
        background: "#fff", borderRadius: 14,
        border: "1px solid #E8E0D4", padding: "20px 18px",
      }}>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 13, fontWeight: 800, color: "#1A1207",
          marginBottom: 12, display: "flex", alignItems: "center", gap: 8,
        }}>ğŸ” æ¢ç©¶æ•™å®¤TRAILã¨ã¯</div>
        <p style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 12, color: "#6B5D4A", lineHeight: 1.75, margin: "0 0 12px",
        }}>ã€Œå•ã„ã‚’ç«‹ã¦ã‚‹åŠ›ã€ã‚’è‚²ã¦ã‚‹å€‹åˆ¥æŒ‡å°æ•™å®¤ã€‚AIæ™‚ä»£ã‚’ç”ŸãæŠœããŸã‚ã«å¿…è¦ãªã€è‡ªåˆ†ã§è€ƒãˆã€æ¢ç©¶ã™ã‚‹åŠ›ã‚’è‚²ã¦ã¾ã™ã€‚</p>
        {[
          ["ğŸ‘¤", "å€‹åˆ¥æŒ‡å°", "1å¯¾1ã§ã€Œå•ã„ã€ã‚’æ·±ã‚ã‚‹"],
          ["ğŸ‘¥", "å°‘äººæ•°åˆ¶", "3ã€œ6äººã§å¯¾è©±çš„ã«å­¦ã¶"],
          ["ğŸ¤–", "AIæ™‚ä»£å¯¾å¿œ", "AIã‚’ä½¿ã„ã“ãªã™åŠ›ã‚’è‚²æˆ"],
        ].map(([icon, title, desc]) => (
          <div key={title} style={{
            display: "flex", gap: 10, alignItems: "flex-start",
            padding: "8px 10px", borderRadius: 10, background: "#F9F4EC",
            marginBottom: 6,
          }}>
            <span style={{ fontSize: 16, flexShrink: 0 }}>{icon}</span>
            <div>
              <div style={{ fontFamily: "'Zen Kaku Gothic New', sans-serif", fontSize: 11, fontWeight: 700, color: "#1A1207" }}>{title}</div>
              <div style={{ fontFamily: "'Zen Kaku Gothic New', sans-serif", fontSize: 10, color: "#8B7355" }}>{desc}</div>
            </div>
          </div>
        ))}
      </div>

      {/* Category Guide */}
      <div style={{
        background: "#fff", borderRadius: 14,
        border: "1px solid #E8E0D4", padding: "20px 18px",
      }}>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 13, fontWeight: 800, color: "#1A1207", marginBottom: 12,
        }}>ğŸ“‚ ã‚«ãƒ†ã‚´ãƒªã‚¬ã‚¤ãƒ‰</div>
        {[
          { icon: "ğŸ¯", name: "å…¥è©¦é€Ÿå ±", desc: "å‡ºé¡˜ãƒ»å€ç‡ãƒ»åˆæ ¼é€Ÿå ±ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§" },
          { icon: "ğŸ«", name: "å­¦æ ¡æƒ…å ±", desc: "æ–°è¨­æ ¡ãƒ»ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ å¤‰æ›´ãƒ»å­¦æ ¡ã®ç‰¹è‰²" },
          { icon: "ğŸ”", name: "æ¢ç©¶ã‚³ãƒ©ãƒ ", desc: "ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®è£å´ã‚’ã€Œæ¢ç©¶ã€ã®ç›®ã§æ·±æ˜ã‚Š" },
          { icon: "ğŸ¤–", name: "AIÃ—æ•™è‚²", desc: "AIæ™‚ä»£ã«å¿…è¦ãªå­¦ã³ã¨æœ€æ–°å‹•å‘" },
          { icon: "ğŸ’¬", name: "è¦ªå­ã§è€ƒãˆã‚‹", desc: "å®¶åº­ã§ä½¿ãˆã‚‹å¯¾è©±ãƒã‚¿ãƒ»æ¢ç©¶ãƒãƒ£ãƒ¬ãƒ³ã‚¸" },
        ].map(cat => (
          <div key={cat.name} style={{
            display: "flex", gap: 10, padding: "8px 0",
            borderBottom: "1px solid #F0EBE2",
          }}>
            <span style={{ fontSize: 14, flexShrink: 0 }}>{cat.icon}</span>
            <div>
              <div style={{ fontFamily: "'Zen Kaku Gothic New', sans-serif", fontSize: 12, fontWeight: 700, color: "#1A1207" }}>{cat.name}</div>
              <div style={{ fontFamily: "'Zen Kaku Gothic New', sans-serif", fontSize: 10, color: "#8B7355" }}>{cat.desc}</div>
            </div>
          </div>
        ))}
      </div>

      {/* Editorial policy */}
      <div style={{
        background: "linear-gradient(135deg, #1A1207 0%, #2D2416 100%)",
        borderRadius: 14, padding: "20px 18px", color: "#FFFCF7",
      }}>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 13, fontWeight: 800, marginBottom: 12,
        }}>âœï¸ ç·¨é›†æ–¹é‡</div>
        {[
          "åå·®å€¤ã«æŒ¯ã‚Šå›ã•ã‚Œãªã„è³¢ã„é¸æŠã‚’å¿œæ´ã—ã¾ã™",
          "ã™ã¹ã¦ã®è¨˜äº‹ã«ã€Œæ¢ç©¶ãƒã‚¤ãƒ³ãƒˆã€ã‚’ã¤ã‘ã€è¦ªå­ã®å¯¾è©±ã®ãã£ã‹ã‘ã‚’ã¤ãã‚Šã¾ã™",
          "AIã¨ä¸€ç·’ã«è€ƒãˆã‚‹åŠ›ã‚’è‚²ã¦ã‚‹è¦–ç‚¹ã‚’å¤§åˆ‡ã«ã—ã¾ã™",
          "å­ã©ã‚‚ãŒè‡ªåˆ†ã§èª­ã‚“ã§ã‚‚ç†è§£ã§ãã‚‹ã‚„ã•ã—ã„æ—¥æœ¬èªã‚’å¿ƒãŒã‘ã¾ã™",
        ].map((text, i) => (
          <div key={i} style={{ display: "flex", gap: 8, marginBottom: 10 }}>
            <span style={{ color: "#F97316", fontSize: 10, marginTop: 4, flexShrink: 0 }}>â—</span>
            <span style={{
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, lineHeight: 1.65, color: "#D4C5AE",
            }}>{text}</span>
          </div>
        ))}
      </div>
    </aside>
  );
}

function Footer() {
  return (
    <footer style={{ background: "#1A1207", padding: "36px 20px 28px", marginTop: 40 }}>
      <div style={{ maxWidth: 960, margin: "0 auto", textAlign: "center" }}>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 16, fontWeight: 900, color: "#FFFCF7", marginBottom: 6,
        }}>ğŸ” ãƒˆãƒ¬ã‚¤ãƒ«æ¢ç©¶ãƒ‹ãƒ¥ãƒ¼ã‚¹</div>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 11, color: "#8B7355", marginBottom: 20,
        }}>æ¢ç©¶æ•™å®¤TRAILãŒå±Šã‘ã‚‹ã€è¦ªå­ã§èª­ã‚€ä¸­å­¦å—é¨“ãƒ‹ãƒ¥ãƒ¼ã‚¹</div>
        <div style={{
          fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 10, color: "#6B5D4A",
        }}>Â© 2026 æ¢ç©¶æ•™å®¤TRAIL. All rights reserved.</div>
      </div>
    </footer>
  );
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ“‹ ç·¨é›†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

function DashboardField({ label, value, onChange, multiline, small }) {
  const common = {
    width: "100%", padding: small ? "8px 12px" : "10px 14px",
    borderRadius: 10, border: "1px solid #D4C5AE",
    background: "#FFFCF7", fontFamily: "'Zen Kaku Gothic New', sans-serif",
    fontSize: 13, color: "#1A1207", outline: "none",
    transition: "border-color 0.2s",
  };
  return (
    <div style={{ marginBottom: 14 }}>
      <label style={{
        display: "block", marginBottom: 5,
        fontFamily: "'Zen Kaku Gothic New', sans-serif",
        fontSize: 11, fontWeight: 700, color: "#8B7355",
      }}>{label}</label>
      {multiline ? (
        <textarea value={value} onChange={e => onChange(e.target.value)}
          rows={4} style={{ ...common, resize: "vertical", lineHeight: 1.7 }}
          onFocus={e => e.target.style.borderColor = "#F97316"}
          onBlur={e => e.target.style.borderColor = "#D4C5AE"}
        />
      ) : (
        <input type="text" value={value} onChange={e => onChange(e.target.value)}
          style={common}
          onFocus={e => e.target.style.borderColor = "#F97316"}
          onBlur={e => e.target.style.borderColor = "#D4C5AE"}
        />
      )}
    </div>
  );
}

function DashboardBodyEditor({ body, onChange }) {
  const updateBlock = (idx, field, val) => {
    const next = [...body];
    next[idx] = { ...next[idx], [field]: val };
    onChange(next);
  };

  return (
    <div style={{ marginBottom: 14 }}>
      <label style={{
        display: "block", marginBottom: 8,
        fontFamily: "'Zen Kaku Gothic New', sans-serif",
        fontSize: 11, fontWeight: 700, color: "#8B7355",
      }}>æœ¬æ–‡ãƒ–ãƒ­ãƒƒã‚¯</label>
      {body.map((block, i) => (
        <div key={i} style={{
          background: "#F9F4EC", borderRadius: 10, padding: "12px 14px",
          marginBottom: 8, position: "relative",
        }}>
          <div style={{
            display: "flex", alignItems: "center", gap: 8, marginBottom: 8,
          }}>
            <span style={{
              padding: "2px 8px", borderRadius: 8,
              background: block.type === "heading" ? "#EA580C22" : block.type === "table" ? "#2563EB22" : "#1A120711",
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 10, fontWeight: 700,
              color: block.type === "heading" ? "#EA580C" : block.type === "table" ? "#2563EB" : "#6B5D4A",
            }}>
              {block.type === "heading" ? "è¦‹å‡ºã—" : block.type === "table" ? "è¡¨" : block.type === "chart" ? "ğŸ“Šã‚°ãƒ©ãƒ•" : block.type === "stat" ? "ğŸ“ˆæ•°å­—" : block.type === "quote" ? "ğŸ’¬å¼•ç”¨" : block.type === "callout" ? "ğŸ“Œæ³¨ç›®" : "æœ¬æ–‡"}
            </span>
            <span style={{
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 10, color: "#A0947E",
            }}>ãƒ–ãƒ­ãƒƒã‚¯ {i + 1}</span>
          </div>
          {block.type === "table" ? (
            <div style={{
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, color: "#8B7355", fontStyle: "italic",
            }}>ï¼ˆè¡¨ã¯ã‚³ãƒ¼ãƒ‰å†…ã§ç›´æ¥ç·¨é›†ã—ã¦ãã ã•ã„ï¼‰</div>
          ) : (
            <textarea
              value={block.content}
              onChange={e => updateBlock(i, "content", e.target.value)}
              rows={block.type === "heading" ? 1 : 3}
              style={{
                width: "100%", padding: "8px 10px", borderRadius: 8,
                border: "1px solid #D4C5AE", background: "#fff",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 12, color: "#1A1207", lineHeight: 1.7,
                resize: "vertical", outline: "none",
                fontWeight: block.type === "heading" ? 700 : 400,
              }}
              onFocus={e => e.target.style.borderColor = "#F97316"}
              onBlur={e => e.target.style.borderColor = "#D4C5AE"}
            />
          )}
        </div>
      ))}
    </div>
  );
}

function ArticleEditor({ article, onUpdate, onClose }) {
  const [draft, setDraft] = useState(JSON.parse(JSON.stringify(article)));
  const [saved, setSaved] = useState(false);

  const set = (field) => (val) => setDraft(d => ({ ...d, [field]: val }));

  const handleSave = () => {
    onUpdate(draft);
    setSaved(true);
    setTimeout(() => setSaved(false), 2000);
  };

  const color = CATEGORY_COLORS[draft.category] || "#6B5D4A";

  return (
    <div style={{ animation: "fadeIn 0.3s ease" }}>
      {/* Header bar */}
      <div style={{
        display: "flex", alignItems: "center", justifyContent: "space-between",
        marginBottom: 20, flexWrap: "wrap", gap: 10,
      }}>
        <button onClick={onClose} style={{
          display: "inline-flex", alignItems: "center", gap: 6,
          padding: "7px 14px", borderRadius: 20,
          border: "1px solid #D4C5AE", background: "#fff",
          cursor: "pointer", fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 12, fontWeight: 600, color: "#6B5D4A",
        }}>â† ä¸€è¦§ã«æˆ»ã‚‹</button>
        <button onClick={handleSave} style={{
          display: "inline-flex", alignItems: "center", gap: 6,
          padding: "8px 20px", borderRadius: 20, border: "none",
          background: saved ? "#059669" : "linear-gradient(135deg, #F97316, #EA580C)",
          cursor: "pointer", fontFamily: "'Zen Kaku Gothic New', sans-serif",
          fontSize: 13, fontWeight: 700, color: "#fff",
          boxShadow: "0 2px 8px rgba(249,115,22,0.3)",
          transition: "all 0.3s ease",
        }}>{saved ? "âœ“ ä¿å­˜ã—ã¾ã—ãŸ" : "ğŸ’¾ ä¿å­˜ã™ã‚‹"}</button>
      </div>

      <div style={{
        display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20,
        alignItems: "start",
      }}>
        {/* Left: Editor */}
        <div style={{
          background: "#fff", borderRadius: 16, border: "1px solid #E8E0D4",
          padding: "24px", maxHeight: "80vh", overflowY: "auto",
        }}>
          <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 14, fontWeight: 800, color: "#1A1207", marginBottom: 18,
            display: "flex", alignItems: "center", gap: 8,
          }}>
            <span style={{ fontSize: 18 }}>{draft.heroEmoji}</span>
            è¨˜äº‹ã‚’ç·¨é›†
          </div>

          {/* Meta */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 4 }}>
            <DashboardField label="æ—¥ä»˜" value={draft.date} onChange={set("date")} small />
            <div style={{ marginBottom: 14 }}>
              <label style={{
                display: "block", marginBottom: 5,
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 11, fontWeight: 700, color: "#8B7355",
              }}>ã‚«ãƒ†ã‚´ãƒª</label>
              <select value={draft.category} onChange={e => set("category")(e.target.value)}
                style={{
                  width: "100%", padding: "8px 12px", borderRadius: 10,
                  border: "1px solid #D4C5AE", background: "#FFFCF7",
                  fontFamily: "'Zen Kaku Gothic New', sans-serif",
                  fontSize: 13, color: "#1A1207", outline: "none",
                }}>
                {Object.entries(CATEGORY_LABELS).map(([k, v]) => (
                  <option key={k} value={k}>{v}</option>
                ))}
              </select>
            </div>
          </div>

          <DashboardField label="ã‚¿ã‚¤ãƒˆãƒ«" value={draft.title} onChange={set("title")} />
          <DashboardField label="è¦ç´„ï¼ˆä¸€è¦§è¡¨ç¤ºç”¨ï¼‰" value={draft.summary} onChange={set("summary")} multiline />

          <DashboardBodyEditor body={draft.body} onChange={set("body")} />

          <DashboardField label="ğŸ§­ æ¢ç©¶ãƒã‚¤ãƒ³ãƒˆ" value={draft.tankyuPoint || ""} onChange={set("tankyuPoint")} multiline />
          <DashboardField label="ğŸ¤– AIæ™‚ä»£ã®è¦–ç‚¹" value={draft.aiAngle || ""} onChange={set("aiAngle")} multiline />
          <DashboardField label="ğŸ’¬ è¦ªå­ã§è©±ãã†" value={draft.oyakoTalk || ""} onChange={set("oyakoTalk")} multiline />

          <DashboardField label="ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰" value={(draft.tags || []).join(", ")}
            onChange={v => set("tags")(v.split(",").map(t => t.trim()).filter(Boolean))} />

          {/* Video URL */}
          <div style={{ marginBottom: 14 }}>
            <label style={{
              display: "block", marginBottom: 5,
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, fontWeight: 700, color: "#8B7355",
            }}>ğŸ¬ é–¢é€£å‹•ç”»ï¼ˆYouTube URLãƒ»ç©ºæ¬„ã§ã‚‚OKï¼‰</label>
            <input type="text"
              placeholder="https://www.youtube.com/watch?v=... ã¾ãŸã¯ https://youtu.be/..."
              value={draft.videoUrl || ""}
              onChange={e => set("videoUrl")(e.target.value)}
              style={{
                width: "100%", padding: "10px 14px", borderRadius: 10,
                border: "1px solid #D4C5AE", background: "#FFFCF7",
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 13, color: "#1A1207", outline: "none",
              }}
              onFocus={e => e.target.style.borderColor = "#F97316"}
              onBlur={e => e.target.style.borderColor = "#D4C5AE"}
            />
            {draft.videoUrl && !extractYouTubeId(draft.videoUrl) && (
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 10, color: "#E8453C", marginTop: 4,
              }}>âš ï¸ YouTube URLã¨ã—ã¦èªè­˜ã§ãã¾ã›ã‚“</div>
            )}
            {draft.videoUrl && extractYouTubeId(draft.videoUrl) && (
              <div style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 10, color: "#059669", marginTop: 4,
              }}>âœ“ å‹•ç”»ã‚’èªè­˜ã—ã¾ã—ãŸï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã§ãã¾ã™ï¼‰</div>
            )}
          </div>
        </div>

        {/* Right: Live Preview */}
        <div style={{
          background: "#FFFCF7", borderRadius: 16, border: "1px solid #E8E0D4",
          padding: "20px", maxHeight: "80vh", overflowY: "auto",
        }}>
          <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, fontWeight: 700, color: "#8B7355",
            marginBottom: 14, display: "flex", alignItems: "center", gap: 6,
          }}>
            <span style={{ fontSize: 14 }}>ğŸ‘ï¸</span> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
          </div>
          <ArticleDetail article={draft} onBack={() => {}} />
        </div>
      </div>
    </div>
  );
}

function Dashboard({ articles, onUpdateArticle }) {
  const [editingId, setEditingId] = useState(null);
  const [searchQuery, setSearchQuery] = useState("");
  const [filterCat, setFilterCat] = useState("all");

  const filtered = articles.filter(a => {
    if (filterCat !== "all" && a.category !== filterCat) return false;
    if (searchQuery && !a.title.includes(searchQuery) && !a.summary.includes(searchQuery)) return false;
    return true;
  });

  if (editingId) {
    const article = articles.find(a => a.id === editingId);
    if (article) {
      return (
        <ArticleEditor
          article={article}
          onUpdate={(updated) => { onUpdateArticle(updated); }}
          onClose={() => setEditingId(null)}
        />
      );
    }
  }

  return (
    <div style={{ animation: "fadeIn 0.3s ease" }}>
      {/* Dashboard header */}
      <div style={{
        display: "flex", alignItems: "center", justifyContent: "space-between",
        marginBottom: 20, flexWrap: "wrap", gap: 12,
      }}>
        <div>
          <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 20, fontWeight: 900, color: "#1A1207",
          }}>ğŸ“‹ è¨˜äº‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
          <div style={{
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, color: "#8B7355", marginTop: 4,
          }}>{articles.length}ä»¶ã®è¨˜äº‹ã‚’ç®¡ç†ä¸­</div>
        </div>
      </div>

      {/* Filters */}
      <div style={{
        display: "flex", gap: 10, marginBottom: 18, flexWrap: "wrap", alignItems: "center",
      }}>
        <input
          type="text" placeholder="ğŸ” è¨˜äº‹ã‚’æ¤œç´¢â€¦"
          value={searchQuery} onChange={e => setSearchQuery(e.target.value)}
          style={{
            padding: "8px 14px", borderRadius: 20, border: "1px solid #D4C5AE",
            background: "#fff", fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, color: "#1A1207", outline: "none", width: 200,
          }}
        />
        <div style={{ display: "flex", gap: 4 }}>
          {[{ id: "all", label: "ã™ã¹ã¦" }, ...Object.entries(CATEGORY_LABELS).map(([k, v]) => ({ id: k, label: v }))].map(c => (
            <button key={c.id} onClick={() => setFilterCat(c.id)} style={{
              padding: "5px 12px", borderRadius: 16, border: "none", cursor: "pointer",
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              fontSize: 11, fontWeight: filterCat === c.id ? 700 : 500,
              background: filterCat === c.id ? "#1A1207" : "#F5F0E8",
              color: filterCat === c.id ? "#fff" : "#6B5D4A",
            }}>{c.label}</button>
          ))}
        </div>
      </div>

      {/* Article list */}
      <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
        {filtered.map((article, i) => {
          const color = CATEGORY_COLORS[article.category] || "#6B5D4A";
          const label = CATEGORY_LABELS[article.category] || "";
          return (
            <div key={article.id}
              onClick={() => setEditingId(article.id)}
              style={{
                display: "flex", alignItems: "center", gap: 14,
                background: "#fff", borderRadius: 12, border: "1px solid #E8E0D4",
                padding: "14px 18px", cursor: "pointer",
                transition: "all 0.2s ease",
                animation: `fadeSlideUp 0.3s ease ${i * 0.03}s both`,
              }}
              onMouseEnter={e => { e.currentTarget.style.borderColor = "#F97316"; e.currentTarget.style.boxShadow = "0 4px 16px rgba(249,115,22,0.1)"; }}
              onMouseLeave={e => { e.currentTarget.style.borderColor = "#E8E0D4"; e.currentTarget.style.boxShadow = "none"; }}
            >
              <span style={{ fontSize: 24, flexShrink: 0 }}>{article.heroEmoji}</span>
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 4 }}>
                  <span style={{
                    padding: "1px 8px", borderRadius: 8,
                    background: `${color}15`, color,
                    fontFamily: "'Zen Kaku Gothic New', sans-serif",
                    fontSize: 10, fontWeight: 700,
                  }}>{label}</span>
                  <span style={{
                    fontFamily: "'Zen Kaku Gothic New', sans-serif",
                    fontSize: 10, color: "#A0947E",
                  }}>{article.date}</span>
                </div>
                <div style={{
                  fontFamily: "'Zen Kaku Gothic New', sans-serif",
                  fontSize: 13, fontWeight: 700, color: "#1A1207",
                  whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis",
                }}>{article.title}</div>
              </div>
              <span style={{
                fontFamily: "'Zen Kaku Gothic New', sans-serif",
                fontSize: 11, color: "#EA580C", fontWeight: 600, flexShrink: 0,
              }}>ç·¨é›† â†’</span>
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸš€ ãƒ¡ã‚¤ãƒ³App
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

function App() {
  const [mode, setMode] = useState("site"); // "site" | "dashboard"
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);
  const [category, setCategory] = useState("all");
  const [dateFilter, setDateFilter] = useState("all");
  const [selectedArticle, setSelectedArticle] = useState(null);
  const [dashAuth, setDashAuth] = useState(false);
  const [dashPw, setDashPw] = useState("");
  const [dashPwErr, setDashPwErr] = useState(false);
  const DASH_PW = "trail2026";

  useEffect(() => {
    fetch("./articles.json")
      .then(r => r.json())
      .then(data => { setArticles(data); setLoading(false); })
      .catch(() => {
        // Fallback: try embedded ARTICLES if available
        if (typeof ARTICLES !== "undefined") { setArticles(ARTICLES); }
        setLoading(false);
      });
  }, []);

  const handleDashLogin = () => {
    if (dashPw === DASH_PW) { setDashAuth(true); setDashPwErr(false); setMode("dashboard"); }
    else { setDashPwErr(true); }
  };

  const filteredArticles = articles.filter(a => {
    if (category !== "all" && a.category !== category) return false;
    if (dateFilter !== "all" && a.dateKey !== dateFilter) return false;
    return true;
  });

  const handleUpdateArticle = (updated) => {
    setArticles(prev => prev.map(a => a.id === updated.id ? updated : a));
  };

  if (loading) {
    return (
      <div style={{ background: "#FFFCF7", minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center" }}>
        <div style={{ textAlign: "center", fontFamily: "'Zen Kaku Gothic New', sans-serif" }}>
          <div style={{ fontSize: 48, marginBottom: 16 }}>ğŸ”</div>
          <div style={{ fontSize: 14, color: "#6B5D4A" }}>è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
      </div>
    );
  }

  return (
    <div style={{ background: "#FFFCF7", minHeight: "100vh" }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700;900&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: #FFFCF7; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #D4C5AE; border-radius: 3px; }
        @keyframes fadeSlideUp {
          from { opacity: 0; transform: translateY(16px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
          from { opacity: 0; } to { opacity: 1; }
        }
        @keyframes calendarSlideIn {
          from { opacity: 0; transform: translateY(-8px) scale(0.96); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; } 50% { opacity: 0.4; }
        }
        @media (max-width: 768px) {
          .main-grid { grid-template-columns: 1fr !important; }
          .editor-grid { grid-template-columns: 1fr !important; }
        }
        textarea:focus, input:focus, select:focus { border-color: #F97316 !important; }
      `}</style>

      {/* Mode toggle bar */}
      <div style={{
        background: "#1A1207", padding: "0 20px",
        display: "flex", alignItems: "center", justifyContent: "center", gap: 4,
      }}>
        {[
          { id: "site", label: "ğŸŒ å…¬é–‹ã‚µã‚¤ãƒˆ" },
          { id: "dashboard", label: "ğŸ“‹ ç·¨é›†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" },
        ].map(m => (
          <button key={m.id} onClick={() => {
            if (m.id === "dashboard" && !dashAuth) { setMode("login"); setSelectedArticle(null); }
            else { setMode(m.id); setSelectedArticle(null); }
          }} style={{
            padding: "10px 20px", border: "none", cursor: "pointer",
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
            fontSize: 12, fontWeight: mode === m.id ? 700 : 500,
            background: mode === m.id ? "#FFFCF7" : "transparent",
            color: mode === m.id ? "#1A1207" : "#8B7355",
            borderRadius: "8px 8px 0 0", marginTop: 4,
            transition: "all 0.2s ease",
          }}>{m.label}</button>
        ))}
      </div>

      {mode === "login" ? (
        <div style={{ maxWidth: 400, margin: "80px auto", padding: "40px 24px", textAlign: "center",
          fontFamily: "'Zen Kaku Gothic New', sans-serif" }}>
          <div style={{ fontSize: 48, marginBottom: 16 }}>ğŸ”’</div>
          <div style={{ fontSize: 18, fontWeight: 700, color: "#1A1207", marginBottom: 8 }}>
            ç·¨é›†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
          </div>
          <div style={{ fontSize: 13, color: "#8B7355", marginBottom: 24 }}>
            ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
          </div>
          <input
            type="password" value={dashPw}
            onChange={e => { setDashPw(e.target.value); setDashPwErr(false); }}
            onKeyDown={e => e.key === "Enter" && handleDashLogin()}
            placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
            style={{
              width: "100%", padding: "12px 16px", fontSize: 15,
              border: dashPwErr ? "2px solid #E8453C" : "2px solid #E8E0D4",
              borderRadius: 10, outline: "none", marginBottom: 8,
              fontFamily: "'Zen Kaku Gothic New', sans-serif",
              background: "#FFFCF7",
            }}
          />
          {dashPwErr && (
            <div style={{ fontSize: 13, color: "#E8453C", marginBottom: 8 }}>
              ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™
            </div>
          )}
          <button onClick={handleDashLogin} style={{
            width: "100%", padding: "12px 0", fontSize: 15, fontWeight: 700,
            background: "#F97316", color: "#FFF", border: "none",
            borderRadius: 10, cursor: "pointer", marginTop: 8,
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
          }}>ãƒ­ã‚°ã‚¤ãƒ³</button>
          <button onClick={() => setMode("site")} style={{
            marginTop: 12, background: "none", border: "none",
            color: "#8B7355", fontSize: 13, cursor: "pointer",
            fontFamily: "'Zen Kaku Gothic New', sans-serif",
          }}>â† ã‚µã‚¤ãƒˆã«æˆ»ã‚‹</button>
        </div>
      ) : mode === "dashboard" ? (
        <div style={{ maxWidth: 1100, margin: "0 auto", padding: "28px 20px" }}>
          <Dashboard articles={articles} onUpdateArticle={handleUpdateArticle} />
        </div>
      ) : (
        <>
          <Header
            onNav={(c) => { setCategory(c); setSelectedArticle(null); }}
            currentCategory={category}
            currentDate={dateFilter}
            onDateChange={(d) => { setDateFilter(d); setSelectedArticle(null); }}
            articles={articles}
          />

          {!selectedArticle && <HeroSection />}

          <main style={{ maxWidth: 960, margin: "0 auto", padding: "28px 20px 0" }}>
            <div className="main-grid" style={{
              display: "grid",
              gridTemplateColumns: selectedArticle ? "1fr" : "1fr 280px",
              gap: 24, alignItems: "start",
            }}>
              <div>
                {selectedArticle ? (
                  <ArticleDetail article={selectedArticle} onBack={() => setSelectedArticle(null)} showComments={true} />
                ) : (
                  <>
                    <div style={{
                      fontFamily: "'Zen Kaku Gothic New', sans-serif",
                      fontSize: 12, fontWeight: 700, color: "#8B7355",
                      marginBottom: 14, letterSpacing: "0.05em",
                    }}>
                      {category === "all" ? "ğŸ“° æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹" : NAV_CATEGORIES.find(c => c.id === category)?.icon + " " + NAV_CATEGORIES.find(c => c.id === category)?.label}
                      {dateFilter !== "all" && ` â€” ${DATE_TABS.find(d => d.key === dateFilter)?.label}`}
                      <span style={{ fontWeight: 400, marginLeft: 8 }}>{filteredArticles.length}ä»¶</span>
                    </div>
                    <div style={{ display: "flex", flexDirection: "column", gap: 14 }}>
                      {filteredArticles.map((article, i) => (
                        <ArticleCard key={article.id} article={article} onSelect={setSelectedArticle} index={i} />
                      ))}
                      {filteredArticles.length === 0 && (
                        <div style={{
                          textAlign: "center", padding: "50px 20px",
                          fontFamily: "'Zen Kaku Gothic New', sans-serif", color: "#A0947E",
                        }}>
                          <div style={{ fontSize: 40, marginBottom: 10 }}>ğŸ“­</div>
                          ã“ã®æ¡ä»¶ã®è¨˜äº‹ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“
                        </div>
                      )}
                    </div>
                  </>
                )}
              </div>
              {!selectedArticle && <Sidebar />}
            </div>
          </main>
          <Footer />
        </>
      )}
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));
  </script>
</body>
</html>
